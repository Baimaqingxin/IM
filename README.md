# 版本迭代

更新于2024年9月1日

目前完成了服务端的代码编写和测试，客户端的代码编写和联调还未完成，完成后更新

# 写在前面

之前用Qt已经完成过一个即时通讯的项目，具体如下：

[Qt项目：C++全栈聊天项目总结](https://zhaobohan.blog.csdn.net/article/details/140205746)

在这个项目的引导下，接触到了如何使用grpc协议来进行RPC调用，之后又对于项目进行了一些其他的改造，主要的侧重点在于对于服务的分布式部署，然后服务和服务之间使用的就是这个rpc协议来进行调用

但是上一个项目并不完善，在很多部分都有可以优化的地方，比如服务注册，服务注册，在这个项目中，服务和服务并不知道对方的存在，只是从配置文件中进行简单的读取，然后根据读取出的ip地址和端口号来进行调用，后来随着学习，了解到了一些服务注册中心，例如Zookeeper，Ectd这些服务

因此做了这个新的项目，这个项目主要是对于上一个项目进行一个进阶的补充，也在一些地方进行优化，比如引入了elasticsearch进行更加高级的文档存储和搜索的服务器，以及ODB进行数据库对象的操作等。总的来说，这个项目比上一个项目更加规范，逻辑更加紧密

# 相关文档

由于项目比较大，将内容写在一篇博客并不现实，所以这里提供链接，对于相关模块感兴趣可以跳转到对应的博客查看，本篇主要进行一个整体架构的逻辑梳理，希望能迅速帮助读者理解项目的大体逻辑


[IM项目：进阶版即时通讯项目---语音识别和验证码服务](https://blog.csdn.net/qq_73899585/article/details/141460813)

[IM项目：进阶版即时通讯项目---文件存储和消息转发](https://blog.csdn.net/qq_73899585/article/details/141532508)

[IM项目：进阶版即时通讯项目---消息存储](https://blog.csdn.net/qq_73899585/article/details/141529430)

[IM项目：进阶版即时通讯项目---用户管理(纯业务)](https://blog.csdn.net/qq_73899585/article/details/141496618)

[IM项目：进阶版即时通讯项目---好友管理和网关服务](https://blog.csdn.net/qq_73899585/article/details/141786167)


# 相关架构

## 网关服务

作为网关，负责和客户端进行直接对接，并在鉴别权限之后，即可分发到对应的服务进行处理，接收到相应后，再返回给客户端，同时包含有用户身份验证的功能，避免被恶意请求所攻击，如果不带有这些字段，那么不予提供任何服务

那对应的提供又分成两种通信，分别是HTTP协议和WebSocket协议

1. Http协议：传统的业务必然使用Http协议就可以，而实际上也有像这种httplib这样的，非常好用的http库，所以在项目中，绝大多数的服务都是借助Http来进行通信的，这样就能满足对应的接口了
2. WebSocket协议：在聊天室项目中，也有一些服务是Http做不到的，需要服务器主动推送资源，而这对于Http协议来说是做不到的，即使在Http后续的优化中引入了主动推送部分资源的功能，但是也依旧不能满足需要。所以就引入了这个WebSocket协议

这也是和前面的项目的第一个不太一样的地方，在上一个项目中，并没有使用对应的WebSocket协议，而是直接基于TCP协议进行了一个自己程度的封装，因为TCP协议本身是一个全双工的协议，所以在Qt中直接使用一个TCP的长连接来对于消息的传输。而在这个项目中，直接使用WebSocket来进行服务，可以向客户端发送数据

网关服务基本就这些内容，下面主要说说网关服务背后的这些微服务的点
## 用户管理

用户管理服务，主要进行用户信息的各项操作，对比第一个版本的项目来说，这里不一样的点主要是多了一个短信验证服务，接入了阿里云的短信认证，可以发送短信，也多了更多的用户信息的修改，多了上传头像的功能，在之前的项目中，并没有对于头像的支持，因为没有含有对应的文件管理系统，所以头像这样的文件资源就没有进行一个合适的存储


## 好友管理

这个模块基本类似，含有获取列表，申请好友，处理请求，删除好友，用户搜索，获取聊天会话这些内容，和上个项目的改进主要体现在了引入了elasticsearch来进行模糊的搜索，elasticsearch也可以理解为是一个可以提供模糊搜索的数据库，在一些特殊的场景下搜索的效率是要比MySQL高的

## 文件管理

这是新加的模块，但其实也比较简单，就是一个单纯的文件的上传和下载，直接使用C++内部封装的文件流的读取和下载即可


## 消息管理

主要的功能是，获取历史消息和消息搜索

## 转发管理

借助RabbitMQ来完成转发服务，关于RabbitMQ在我的项目中也有介绍到，这里选该队列主要考虑到主题式的分发可能更加适合于当前的场景

## 语音转换

这里主要是借助的是百度云的SDK，直接调用其接口即可，在上面进行了一些二次的封装

